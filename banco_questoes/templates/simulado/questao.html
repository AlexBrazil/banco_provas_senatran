{% load static %}

<link rel="stylesheet" href="{% static 'simulado/simulado.css' %}">

<div class="simulado-container simulado-questao">

  <h2 class="simulado-titulo">
    Questão {{ idx|add:1 }} de {{ total }} ({{ acertos|default:0 }} acertos / {{ erros|default:0 }} erros)
  </h2>

  <p class="simulado-contagem">
    Acertos: {{ acertos|default:0 }} | Erros: {{ erros|default:0 }}
  </p>

  <p class="simulado-modulo">
    <strong>{{ questao.modulo.nome }}</strong>
  </p>

  <p class="simulado-enunciado">
    {{ questao.enunciado }}
  </p>

  {% if questao.imagem_arquivo %}
    <div class="questao-imagem-wrapper">
      <img
        src="{% static 'placas/' %}{{ questao.imagem_arquivo }}"
        alt="Imagem da questão"
        class="questao-imagem"
        onerror="this.closest('.questao-imagem-wrapper').style.display='none';"
      >
      <small class="questao-imagem-label">
        Arquivo: {{ questao.imagem_arquivo }}
      </small>
    </div>
  {% endif %}

  {% if feedback %}
    {% if feedback.is_correct %}
      <p class="feedback-ok">
        <span class="feedback-icon">&#10003;</span>
        Você acertou!
      </p>
      {% if feedback.selecionada %}
        <p class="feedback-tip"><strong>Sua resposta:</strong> {{ feedback.selecionada.texto }}</p>
      {% endif %}
      {% if feedback.comentario %}
        <p class="feedback-tip"><strong>Comentário:</strong> {{ feedback.comentario }}</p>
      {% endif %}
    {% endif %}
    <div class="feedback {% if feedback.is_correct %}feedback--ok{% else %}feedback--error{% endif %}">
      {% if not feedback.is_correct %}
        {% if feedback.percent_acerto <= 50 %}
          <p class="feedback-error">
            <span class="feedback-icon">&#10007;</span>
            Não foi desta vez, estude mais um pouco.
          </p>
        {% elif feedback.percent_acerto <= 70 %}
          <p class="feedback-error">
            <span class="feedback-icon">&#10007;</span>
            Essa você errou, mas está indo bem, na próxima preste mais atenção na questão.
          </p>
        {% else %}
          <p class="feedback-error">
            <span class="feedback-icon">&#10007;</span>
            Essa você errou, mas caso se esforce mais, irá gabaritar a prova.
          </p>
        {% endif %}
        {% if feedback.selecionada %}
          <p class="feedback-tip"><strong>Sua resposta:</strong> {{ feedback.selecionada.texto }}</p>
        {% endif %}
        {% if feedback.correta %}
          <p class="feedback-tip"><strong>Resposta correta:</strong> {{ feedback.correta.texto }}</p>
        {% endif %}
        {% if feedback.comentario %}
          <p class="feedback-tip"><strong>Comentário:</strong> {{ feedback.comentario }}</p>
        {% endif %}
      {% endif %}
    </div>
    <a class="btn-simulado" href="{{ feedback.next_url }}">
      {% if feedback.is_last %}Ver resultado{% else %}Próxima questão{% endif %}
    </a>
  {% else %}
    <form method="post" action="{% url 'simulado:responder' %}" class="simulado-form">
      {% csrf_token %}

      {% for a in alternativas %}
        <div class="alternativa">
          <label class="alternativa-label">
            <input
              type="radio"
              name="alternativa_id"
              value="{{ a.id }}"
              required
              class="alternativa-radio"
            >
            <span class="alternativa-texto">
              {{ a.texto }}
            </span>
          </label>
        </div>
      {% endfor %}

      <button type="submit" class="btn-simulado">
        Responder
      </button>
    </form>
  {% endif %}

</div>
